## Fliplet Event – Playwright Test Suite

End-to-end, journeys, RBAC, performance, and accessibility tests for the Fliplet Event app using Playwright.

### Key Features
- Global setup project generates role-based `storageState` for fast, isolated tests
- Global teardown cleans auth artifacts for clean runs
- Projects split by feature area and role for parallel CI execution
- Role-first, user-centric selectors (`getByRole`, `getByLabel`, `getByTestId`)
- Trace-on-retry, HTML reporting, and UI mode for local debugging
- **API Testing Framework** with Fliplet Data Sources integration
- **Clean Architecture** with separated utils/ and helpers/ layers

### Prerequisites
- Node.js 18+
- Git and a modern shell
- Installed browsers: `npm run test:install`

### Quick Start
```bash
npm ci
cp env.example .env   # set BASE_URL and user credentials
npm run test:install  # installs Playwright browsers
npm test              # run entire suite
```

### Environment Variables (.env)
The suite reads configuration from `.env` via `test-data/app.data.ts`.

Required keys:
```
BASE_URL=

ADMIN_EMAIL=
ADMIN_PASSWORD=
ATTENDEE_EMAIL=
ATTENDEE_PASSWORD=
EXHIBITOR_EMAIL=
EXHIBITOR_PASSWORD=
SPEAKER_EMAIL=
SPEAKER_PASSWORD=

INVALID_EMAIL=
INVALID_PASSWORD=

# API Testing (Optional)
API_BASE_URL=https://api.fliplet.com/v1
FLIPLET_API_TOKEN=your_api_token_here
AGENDA_DS=your_agenda_data_source_id
```

### NPM Scripts
```bash
# Full suite
npm test

# Subsets
npm run test:user
npm run test:admin
npm run test:features
npm run test:journeys
npm run test:e2e
npm run test:regression
npm run test:smoke

# API Testing
npm run test:api

# Parallel/CI-friendly
npm run test:parallel
npm run test:ci

# Debugging & tooling
npm run test:headed
npm run test:debug
npm run test:ui
npm run test:report
npm run test:trace
```

### Playwright Configuration Highlights
- `playwright.config.ts`
  - `fullyParallel: true`, `retries` enabled on CI, `reporter: 'html'`
  - `use.baseURL` from `.env` and `trace: 'on-first-retry'`
  - `projects`
    - `setup`: runs `global-setup/auth.setup.ts` to persist `storage-state/*.json`
    - Feature projects (Admin/Attendee/Exhibitor/Speaker/Auth) use role storage states and match relevant spec directories
  - `globalTeardown`: `global-setup/global-teardown.ts` removes `storage-state/*.json`

Run just the setup project (useful while developing login flows):
```bash
npx playwright test --project=setup
```

Run only Admin specs:
```bash
npx playwright test --project="Admin Tests"
```

Manually trigger global teardown (skip all tests but execute teardown):
```bash
npx playwright test --grep-invert ".*"
```

### Repository Structure
```
global-setup/            # auth.setup.ts creates storage state; global-teardown.ts cleans artifacts
page-objects/            # Page Object Model (one file per screen/feature)
helpers/                 # Business logic helpers
  auth/                  # Login business logic (login.ts)
  data/                  # Data source API helpers
    agendaHelpers.ts     # Agenda API operations
    constants.ts         # Data source configuration
    flipletApiClient.ts  # Main API client facade
tests/
  auth/                  # Login, onboarding, registration, password reset
  admin/                 # Admin features (content, attendance, agenda, etc.)
  user/                  # Attendee features (agenda, meetings, networking, etc.)
  journeys/              # Cross-page user journeys by role
  rbac/                  # Role-based access control
  accessibility/         # A11y checks and screen reader flows
  api/                   # API testing (Fliplet Data Sources)
    agenda-api-integration.spec.ts  # Insert/Delete with file persistence
    crud-operations.spec.ts         # Clean API operations testing
  performance/           # Basic performance checks
utils/                   # Low-level utilities
  api/                   # Generic API operations
    dataSourceApi.ts     # Core CRUD functions (createEntry, deleteEntry)
  page-manager.ts        # Page navigation utilities
  page-url-resolver.ts   # URL resolution utilities
fixtures/                # Test data templates
  api/                   # API request body templates
test-data/               # Environment-configured test data
storage-state/           # Auth contexts (generated by setup)
playwright-report/       # HTML reports (generated)
test-results/            # Raw artifacts (generated)
```

### API Testing Framework

The framework includes a comprehensive API testing system for Fliplet Data Sources:

#### Architecture
- **`utils/api/dataSourceApi.ts`**: Low-level HTTP operations (createEntry, deleteEntry)
- **`helpers/data/agendaHelpers.ts`**: Business logic for Agenda operations
- **`helpers/data/constants.ts`**: Centralized data source configuration
- **`helpers/data/flipletApiClient.ts`**: Main facade for API access

#### Usage Example
```typescript
import { FlipletAPIClient } from '../../helpers/data/flipletApiClient';

test('API Operations', async () => {
  const api = new FlipletAPIClient(apiContext);
  
  // Insert operation
  const entryId = await api.agenda.createSession(sessionData);
  expect(entryId).toBeGreaterThan(0);
  
  // Delete operation
  await api.agenda.deleteSession(entryId);
});
```

#### Supported Operations
- **Insert**: `PUT /v1/data-sources/:id/data` - Create new entries
- **Delete**: `DELETE /v1/data-sources/:id/data/:entryId` - Remove entries

#### Test Files
- **`agenda-api-integration.spec.ts`**: Integration testing with file persistence
- **`crud-operations.spec.ts`**: Clean unit testing of API operations

#### Login Helper
The framework includes a login helper for clean authentication flows:

```typescript
import { loginAsAdmin, loginAsAttendee } from '../../helpers/auth/login';

test('Admin can manage content', async ({ page }) => {
  await loginAsAdmin(page);  // Complete login flow
  // ... test logic
});
```

**Available Functions**:
- `loginAsAdmin(page)` - Complete admin login flow
- `loginAsAttendee(page)` - Complete attendee login flow  
- `loginAsSpeaker(page)` - Complete speaker login flow
- `loginAsExhibitor(page)` - Complete exhibitor login flow
- `loginWithCredentials(page, username, password)` - Custom credentials

### Page Objects & Selectors
- Prefer resilient, user-facing locators: `page.getByRole`, `page.getByLabel`, `page.getByText`, `page.getByTestId`
- Avoid brittle CSS/XPath; add `data-testid` where necessary for stability
- Keep page objects lean: expose clear, task-oriented methods that mirror user actions

### Setup and Teardown Flow
- Setup generates storage states for roles (Admin, Attendee, Exhibitor, Speaker)
- Projects that depend on setup reference the appropriate `storageState`
- Global teardown removes storage state files to ensure independence between runs

### Running With Traces, Headed, UI
```bash
npx playwright test --headed
npx playwright test --debug
npx playwright test --trace=on           # always trace
npx playwright show-report               # open HTML report
npx playwright show-trace trace.zip      # open saved trace
```

### CI/CD Notes
- Entirely CLI-driven; suitable for any CI runner
- Recommended defaults:
  - `npx playwright install --with-deps`
  - `npm ci && npm run test:ci`
  - Upload `playwright-report/` as an artifact

### Conventions & Principles
- Separation of Concerns: tests vs. page objects vs. data
- DRY: extract reusable flows into helpers/page objects
- Test Independence & Atomicity: no hidden state; do not depend on prior test
- AAA: Arrange inputs, Act with one user action, Assert results
- Explicit waits via Playwright’s auto-wait and web-first assertions; no fixed sleeps
- Stable selectors first (`getByRole`, `getByTestId`), avoid fragile selectors
- KISS: keep tests simple, readable, and maintainable

### Troubleshooting
- "No tests found" when running setup or teardown-only commands is expected if you purposely filter tests
- Ensure `.env` is populated; missing `BASE_URL` or credentials cause navigation/login failures
- If report doesn’t open: run `npm run test:report`

### License
ISC


